# CRCON QQ Bot 命令使用手册

本文档详细介绍了 CRCON QQ 机器人的所有可用命令及其使用方法。

## 权限系统

本机器人采用三级权限管理系统：

### 🔴 主人权限 (OWNER)
- 拥有所有系统权限
- 可以执行系统命令（重启机器人、API测试等）
- 拥有超级管理员的所有权限
- 配置方式：在 `.env` 文件中设置 `SUPERUSERS`

### 🟡 超级管理员权限 (SUPER_ADMIN)
- 拥有所有管理员命令权限
- 可以添加/删除普通管理员
- 可以查看权限信息和管理员列表
- 管理方式：由主人通过命令添加

### 🟢 普通管理员权限 (ADMIN)
- 拥有所有游戏管理命令
- 包括玩家管理、地图管理、VIP管理等
- 无法管理其他管理员
- 管理方式：由超级管理员或主人添加

## 命令分类

### 🎮 玩家命令（所有用户可用）
- [服务器信息查询](#服务器信息查询)
- [VIP 状态查询](#vip-状态查询)
- [帮助信息](#帮助信息)

### 🟢 普通管理员命令（需要管理员权限）
- [玩家列表](#玩家列表)
- [踢出玩家](#踢出玩家)
- [封禁玩家](#封禁玩家)
- [惩罚玩家](#惩罚玩家)
- [切换玩家](#切换玩家)
- [消息管理](#消息管理)
- [地图管理](#地图管理)
- [服务器设置](#服务器设置)

### 🟡 超级管理员命令（需要超级管理员权限）
- [添加管理员](#添加管理员)
- [删除管理员](#删除管理员)
- [管理员列表](#管理员列表)
- [权限信息](#权限信息)

### 🔴 系统命令（需要主人权限）
- [机器人状态](#机器人状态)
- [API 测试](#api-测试)
- [机器人重启](#机器人重启)

---

## 🎮 玩家命令

### 服务器信息查询

查询指定服务器的当前状态信息。

**命令格式**:
```
/服务器信息 [服务器编号]
/服务器状态 [服务器编号]
/server [服务器编号]
/status [服务器编号]
```

**参数说明**:
- `服务器编号`: 1 或 2，默认为 1

**使用示例**:
```
/服务器信息
/服务器信息 1
/server 2
/status
```

**返回信息**:
- 服务器名称
- 当前地图
- 在线玩家数量
- 游戏模式
- 服务器运行时间

### VIP 状态查询

查询指定玩家的 VIP 状态。

**命令格式**:
```
/查询vip <玩家名称> [服务器编号]
/vip查询 <玩家名称> [服务器编号]
/checkvip <玩家名称> [服务器编号]
```

**参数说明**:
- `玩家名称`: 要查询的玩家名称（必填）
- `服务器编号`: 1 或 2，默认为 1

**使用示例**:
```
/查询vip PlayerName
/vip查询 PlayerName 2
/checkvip "Player Name"
```

**返回信息**:
- VIP 状态（是/否）
- VIP 到期时间（如果是 VIP）
- 玩家在线状态

### 帮助信息

显示可用命令的帮助信息。

**命令格式**:
```
/帮助
/help
/指令
```

**使用示例**:
```
/帮助
/help
```

---

## 🟢 普通管理员命令

> ⚠️ **注意**: 以下命令需要管理员权限（普通管理员、超级管理员或主人）。

### 玩家列表

显示指定服务器的在线玩家列表。

**命令格式**:
```
/玩家列表 [服务器编号]
/players [服务器编号]
```

**参数说明**:
- `服务器编号`: 1 或 2，默认为 1

**使用示例**:
```
/玩家列表
/玩家列表 2
/players 1
```

**返回信息**:
- 玩家编号
- 玩家名称
- 队伍
- 击杀/死亡数
- 在线时长

### 踢出玩家

将指定玩家踢出服务器。

**命令格式**:
```
/踢出 <玩家编号或范围> [服务器编号] [原因]
/kick <玩家编号或范围> [服务器编号] [原因]
```

**参数说明**:
- `玩家编号或范围`: 单个编号（如 1）或范围（如 1-3）
- `服务器编号`: 1 或 2，默认为 1
- `原因`: 踢出原因，默认为 "违反服务器规则"

**使用示例**:
```
/踢出 1
/踢出 1-3 1 违规行为
/kick 5 2 "Inappropriate behavior"
```

### 封禁玩家

对玩家进行临时或永久封禁。

**临时封禁命令格式**:
```
/临时封禁 <玩家编号或范围> <时长> [服务器编号] [原因]
/tempban <玩家编号或范围> <时长> [服务器编号] [原因]
```

**永久封禁命令格式**:
```
/永久封禁 <玩家编号或范围> [服务器编号] [原因]
/permaban <玩家编号或范围> [服务器编号] [原因]
```

**参数说明**:
- `玩家编号或范围`: 单个编号或范围
- `时长`: 封禁时长，格式如 "1h"（1小时）、"30m"（30分钟）、"1d"（1天）
- `服务器编号`: 1 或 2，默认为 1
- `原因`: 封禁原因

**使用示例**:
```
/临时封禁 1 2h
/临时封禁 1-2 30m 1 作弊行为
/tempban 3 1d 2 "Cheating detected"
/永久封禁 5 恶意破坏
/permaban 1-3 2 "Multiple violations"
```

### 惩罚玩家

对玩家进行惩罚（通常是击杀）。

**命令格式**:
```
/惩罚 <玩家编号或范围> [服务器编号] [原因]
/punish <玩家编号或范围> [服务器编号] [原因]
```

**参数说明**:
- `玩家编号或范围`: 单个编号或范围
- `服务器编号`: 1 或 2，默认为 1
- `原因`: 惩罚原因

**使用示例**:
```
/惩罚 1
/惩罚 1-2 1 违规行为
/punish 3 2 "Rule violation"
```

### 切换玩家

将玩家切换到对方队伍。

**立即切换命令格式**:
```
/立即切换 <玩家编号或范围> [服务器编号]
/switch <玩家编号或范围> [服务器编号]
```

**死亡后切换命令格式**:
```
/死亡切换 <玩家编号或范围> [服务器编号]
/switchdeath <玩家编号或范围> [服务器编号]
```

**参数说明**:
- `玩家编号或范围`: 单个编号或范围
- `服务器编号`: 1 或 2，默认为 1

**使用示例**:
```
/立即切换 1
/立即切换 1-3 2
/switch 2
/死亡切换 1-2 1
/switchdeath 3
```

### 消息管理

向服务器内的玩家发送私信消息。

#### 私信玩家

向指定的一个或多个玩家发送私信。

**命令格式**:
```
/私信玩家 <玩家序号> <消息内容> [服务器编号]
/私信 <玩家序号> <消息内容> [服务器编号]
/message <玩家序号> <消息内容> [服务器编号]
```

**参数说明**:
- `玩家序号`: 玩家在列表中的序号，支持以下格式：
  - 单个序号：`1`
  - 多个序号：`1,3,5`（用逗号分隔）
  - 范围序号：`1-5`（表示1到5号玩家）
  - 混合格式：`1,3-5,7`（1号、3到5号、7号玩家）
- `消息内容`: 要发送的消息文本
- `服务器编号`: 1 或 2，默认为 1

**使用示例**:
```
/私信玩家 1 欢迎来到服务器！
/私信 1,3,5 请注意游戏规则
/message 1-5 活动即将开始
/私信玩家 1,3-5,7 重要通知：服务器将在10分钟后重启 2
```

**成功提示示例**:
```
💬 私信发送结果
==============================
📝 消息内容：欢迎来到服务器！
🎮 服务器：1
✅ 成功发送：3 人
❌ 发送失败：5(PlayerName)
```

#### 全体私信

向服务器内所有在线玩家发送私信（最多支持100人）。

**命令格式**:
```
/全体私信 <消息内容> [服务器编号]
/广播私信 <消息内容> [服务器编号]
/broadcast <消息内容> [服务器编号]
```

**参数说明**:
- `消息内容`: 要发送的消息文本
- `服务器编号`: 1 或 2，默认为 1

**使用示例**:
```
/全体私信 服务器将在5分钟后重启，请做好准备
/广播私信 欢迎参加今晚的活动！
/broadcast 重要通知：新的游戏规则已生效 2
```

**成功提示示例**:
```
📢 全体私信发送结果
==============================
📝 消息内容：服务器将在5分钟后重启，请做好准备
🎮 服务器：1
👥 目标玩家：45 人
✅ 成功发送：43 人
❌ 发送失败：12(PlayerA), 25(PlayerB)
```

**重要提示**:
- 私信功能需要管理员权限
- 全体私信最多支持100名在线玩家
- 如果玩家数量超过100人，系统会拒绝执行
- 消息发送失败的玩家会在结果中显示
- 玩家序号基于当前在线玩家列表，可通过 `/管理员玩家列表` 查看

### 地图管理

更换服务器当前地图。

**命令格式**:
```
/换图 <地图名称或编号> [服务器编号]
/changemap <地图名称或编号> [服务器编号]
/切换地图 <地图名称或编号> [服务器编号]
```

**参数说明**:
- `地图名称或编号`: 地图名称或编号（支持中文名称、英文名称和编号）
- `服务器编号`: 1 或 2，默认为 1

**⚠️ 重要提示**:
- 地图切换命令执行后，**预计1分钟后生效**
- 机器人会提示"地图切换命令已执行"，这表示命令已成功发送到服务器
- 实际切换时间取决于服务器当前状态（游戏进行中可能需要等待回合结束）

**支持的地图**:

**🎯 Warfare 模式地图（编号1-10）**:
1. `carentan_warfare` - 卡朗坦
2. `driel_warfare` - 德里尔
3. `foy_warfare` - 芬诺维尔
4. `kharkov_warfare` - 哈尔科夫
5. `kursk_warfare` - 库尔斯克
6. `omahabeach_warfare` - 奥马哈海滩
7. `PHL_L_1944_Warfare` - 紫心小道
8. `remagen_warfare` - 雷马根
9. `stmereeglise_warfare` - 圣梅尔埃格利斯
10. `stmariedumont_warfare` - 圣玛丽杜蒙

**🎯 Offensive 模式地图（编号11-24）**:
11. `stmereeglise_offensive_ger` - 圣梅尔埃格利斯（德军进攻）
12. `stmereeglise_offensive_us` - 圣梅尔埃格利斯（美军进攻）
13. `utahbeach_offensive_ger` - 犹他海滩（德军进攻）
14. `utahbeach_offensive_us` - 犹他海滩（美军进攻）
15. `driel_offensive_ger` - 德里尔（德军进攻）
16. `driel_offensive_us` - 德里尔（美军进攻）
17. `omahabeach_offensive_ger` - 奥马哈海滩（德军进攻）
18. `omahabeach_offensive_us` - 奥马哈海滩（美军进攻）
19. `kharkov_offensive_ger` - 哈尔科夫（德军进攻）
20. `kharkov_offensive_us` - 哈尔科夫（美军进攻）
21. `carentan_offensive_ger` - 卡朗坦（德军进攻）
22. `carentan_offensive_us` - 卡朗坦（美军进攻）
23. `stalingrad_offensive_ger` - 斯大林格勒（德军进攻）
24. `stalingrad_offensive_us` - 斯大林格勒（美军进攻）

**使用示例**:
```
# 使用编号换图（推荐）
/换图 1              # 切换到卡朗坦 warfare
/换图 5 2            # 在服务器2切换到库尔斯克 warfare

# 使用完整地图名称
/换图 foy_warfare
/换图 stmereeglise_offensive_ger 2

# 使用中文名称（部分支持）
/换图 芬诺维尔
/换图 奥马哈海滩 2
```

**成功提示示例**:
```
✅ 地图切换命令已执行
🗺️ 目标地图：foy_warfare
🎮 服务器：1
⏰ 预计1分钟后生效
```

### 服务器设置

设置服务器的空闲踢出时间。

**命令格式**:
```
/设置空闲时间 <时间> [服务器编号]
/setidle <时间> [服务器编号]
```

**参数说明**:
- `时间`: 空闲时间（分钟），0 表示禁用
- `服务器编号`: 1 或 2，默认为 1

**使用示例**:
```
/设置空闲时间 10
/设置空闲时间 0 2
/setidle 15 1
```

### 管理员帮助

显示管理员命令的详细帮助信息。

**命令格式**:
```
/管理帮助
/adminhelp
```

---

## 🟡 超级管理员命令

> ⚠️ **注意**: 以下命令需要超级管理员权限或主人权限。

### 添加管理员

将指定用户添加为普通管理员。

**命令格式**:
```
/添加管理员 <QQ号>
/addadmin <QQ号>
/管理员添加 <QQ号>
```

**参数说明**:
- `QQ号`: 要添加为管理员的用户QQ号

**使用示例**:
```
/添加管理员 123456789
/addadmin 987654321
```

### 删除管理员

移除指定用户的普通管理员权限。

**命令格式**:
```
/删除管理员 <QQ号>
/removeadmin <QQ号>
/管理员删除 <QQ号>
```

**参数说明**:
- `QQ号`: 要移除管理员权限的用户QQ号

**使用示例**:
```
/删除管理员 123456789
/removeadmin 987654321
```

### 管理员列表

查看当前所有管理员的列表。

**命令格式**:
```
/管理员列表
/listadmins
/查看管理员
```

**使用示例**:
```
/管理员列表
```

### 权限信息

查看指定用户或自己的权限信息。

**命令格式**:
```
/权限信息 [QQ号]
/perminfo [QQ号]
/查看权限 [QQ号]
```

**参数说明**:
- `QQ号`: 要查询的用户QQ号，不填则查询自己的权限

**使用示例**:
```
/权限信息
/权限信息 123456789
```

---

## 🔴 系统命令

> ⚠️ **注意**: 以下命令需要主人权限。

### 机器人状态

查看机器人的运行状态和统计信息。

**命令格式**:
```
/状态
/status
/机器人状态
```

**使用示例**:
```
/状态
```

### API 测试

测试与 CRCON API 的连接状态。

**命令格式**:
```
/API测试
/apitest
/测试连接
```

**使用示例**:
```
/API测试
```

### 机器人重启

重启机器人。

**命令格式**:
```
/重启机器人
/restart
```

**使用示例**:
```
/重启机器人
```

---

## 📝 使用技巧

### 1. 玩家编号范围

在管理员命令中，您可以使用以下格式指定玩家：

- **单个玩家**: `1`
- **多个玩家**: `1,3,5`
- **连续范围**: `1-5`
- **混合格式**: `1,3-5,8`

### 2. 时间格式

在封禁命令中，支持以下时间格式：

- **分钟**: `30m`、`45min`
- **小时**: `2h`、`1hour`
- **天**: `1d`、`3day`、`1days`
- **周**: `1w`、`2week`

### 3. 地图名称

支持使用编号、中文名称或英文名称，不区分大小写：

```
/换图 1             # 使用编号（推荐）
/换图 芬诺维尔      # 中文名称
/换图 foy_warfare   # 英文名称
/换图 FOY_WARFARE   # 大写也可以
```

### 4. 玩家序号格式

私信功能支持多种序号格式：

```
/私信玩家 1 消息内容              # 单个玩家
/私信玩家 1,3,5 消息内容          # 多个玩家（逗号分隔）
/私信玩家 1-5 消息内容            # 范围玩家（1到5号）
/私信玩家 1,3-5,7 消息内容        # 混合格式
```

### 5. 引号使用

当参数包含空格时，请使用引号：

```
/踢出 1 1 "违反服务器规则"
/vip查询 "Player Name"
/私信玩家 1 "欢迎来到我们的服务器！"
```

### 6. 服务器编号

- 大多数命令的服务器编号都是可选的，默认为服务器 1
- 如果只有一个服务器，可以忽略服务器编号参数

---

## ❗ 常见错误

### 1. 权限不足
```
❌ 权限不足，此命令需要相应权限
```
**解决方案**: 确保您的 QQ 号在配置文件的 `SUPERUSERS` 列表中。

### 2. 服务器编号无效
```
❌ 无效的服务器编号，请使用 1 或 2
```
**解决方案**: 使用正确的服务器编号（1 或 2）。

### 3. 玩家不存在
```
❌ 未找到指定编号的玩家
```
**解决方案**: 先使用 `/玩家列表` 查看当前在线玩家及其编号。

### 4. API 连接失败
```
❌ API 请求失败，请稍后重试
```
**解决方案**: 
- 检查网络连接
- 确认 CRCON 服务器是否正常运行
- 验证 API 令牌是否有效

### 5. 参数格式错误
```
❌ 参数格式错误，请查看帮助信息
```
**解决方案**: 使用 `/帮助` 或 `/管理帮助` 查看正确的命令格式。

### 6. 玩家序号无效
```
❌ 玩家序号格式错误：序号不能小于1
❌ 玩家序号格式错误：无效的范围格式: 5-3
```
**解决方案**: 
- 确保序号在1-100范围内
- 范围格式中起始值不能大于结束值
- 使用正确的格式：单个序号、逗号分隔或范围格式

### 7. 消息发送限制
```
❌ 当前在线玩家数量(120)超过限制(100人)，请稍后重试
```
**解决方案**: 全体私信功能限制最多100名在线玩家，请等待玩家数量减少后重试。

---

## 🔧 高级用法

### 批量操作

您可以对多个玩家执行相同操作：

```
/踢出 1-5 1 批量清理
/临时封禁 1,3,5 30m 1 违规行为
/立即切换 2-4
/私信玩家 1-10 欢迎新玩家！
/私信玩家 1,5,8 请注意游戏规则
```

### 组合命令

在管理服务器时，可以组合使用多个命令：

```
1. /玩家列表                    # 查看当前玩家
2. /踢出 1-2 违规               # 踢出违规玩家
3. /私信玩家 3-10 欢迎来到服务器 # 欢迎新玩家
4. /换图 3                      # 更换地图（使用编号）
5. /全体私信 地图已更换，请重新进入游戏 # 通知所有玩家
6. /状态                        # 检查机器人状态
```

### 定时任务

机器人会自动执行一些定时任务：

- **健康检查**: 每 5 分钟检查一次 API 连接状态
- **日志轮转**: 每天轮转日志文件
- **状态更新**: 定期更新机器人状态信息

---

如果您在使用过程中遇到问题，请查看日志文件或联系管理员获取帮助。